<!DOCTYPE html>
<html lang="ru">
<head>
    {{template "head" .}}
    <title>{{.Lesson.Title}} ‚Äî Go Learning</title>
</head>
<body>
    {{template "header" .}}
    
    <main class="main">
        <div class="lesson-page">
            <aside class="lesson-sidebar">
                <div class="lesson-nav">
                    {{if .PrevLesson}}
                    <a href="/lessons/{{.PrevLesson.Slug}}" class="nav-btn prev">‚Üê –ù–∞–∑–∞–¥</a>
                    {{else}}
                    <span class="nav-btn disabled">‚Üê –ù–∞–∑–∞–¥</span>
                    {{end}}
                    {{if .NextLesson}}
                    <a href="/lessons/{{.NextLesson.Slug}}" class="nav-btn next">–î–∞–ª–µ–µ ‚Üí</a>
                    {{else}}
                    <span class="nav-btn disabled">–î–∞–ª–µ–µ ‚Üí</span>
                    {{end}}
                </div>
                
                <nav class="toc">
                    <h3>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</h3>
                    <ul>
                        {{range .Lesson.Sections}}
                        <li><a href="#section-{{.ID}}">{{sectionIcon .Kind}} {{.Title}}</a></li>
                        {{end}}
                        {{if .Lesson.Tasks}}
                        <li><a href="#practice">üìù –ü—Ä–∞–∫—Ç–∏–∫–∞</a></li>
                        {{end}}
                        <li><a href="#notes">üìí –ó–∞–º–µ—Ç–∫–∏</a></li>
                    </ul>
                </nav>
                
                <div class="progress-widget">
                    <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å</h3>
                    <div class="status-buttons">
                        <button class="status-btn {{if eq .Progress.Status "reading"}}active{{end}}" 
                                data-status="reading" data-lesson-id="{{.Lesson.ID}}">
                            üìñ –ß–∏—Ç–∞—é
                        </button>
                        <button class="status-btn {{if eq .Progress.Status "done"}}active{{end}}" 
                                data-status="done" data-lesson-id="{{.Lesson.ID}}">
                            ‚úÖ –ü—Ä–æ–π–¥–µ–Ω
                        </button>
                    </div>
                </div>
            </aside>
            
            <article class="lesson-content">
                <header class="lesson-header">
                    {{if .Lesson.Module}}
                    <span class="module-badge">{{.Lesson.Module.Title}}</span>
                    {{end}}
                    <h1>{{.Lesson.Title}}</h1>
                    <div class="lesson-meta-bar">
                        <span>‚è± ~{{.Lesson.ReadingTimeMin}} –º–∏–Ω</span>
                        {{if .Lesson.SourceURL}}
                        <a href="{{.Lesson.SourceURL}}" target="_blank" rel="noopener" class="source-link">–ò—Å—Ç–æ—á–Ω–∏–∫ ‚Üó</a>
                        {{end}}
                    </div>
                </header>
                
                {{range .Lesson.Sections}}
                <section id="section-{{.ID}}" class="lesson-section section-{{.Kind}}">
                    <h2>{{sectionIcon .Kind}} {{.Title}}</h2>
                    <div class="section-content markdown">
                        {{.BodyMD | markdown}}
                    </div>
                </section>
                {{end}}
                
                {{if .Lesson.Tasks}}
                <section id="practice" class="lesson-section section-practice">
                    <h2>üìù –ü—Ä–∞–∫—Ç–∏–∫–∞</h2>
                    
                    {{range .Lesson.Tasks}}
                    <div class="task-card" data-task-id="{{.ID}}" data-task-mode="{{.Mode}}" {{if index $.CompletedTasks .ID}}data-completed="true"{{end}}>
                        <div class="task-header">
                            <h3>{{.Title}}</h3>
                            {{if index $.CompletedTasks .ID}}
                            <span class="task-points completed">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
                            {{else}}
                            <span class="task-points">{{.Points}} –æ—á–∫–æ–≤</span>
                            {{end}}
                        </div>

                        {{if eq .Mode "manual"}}
                        <div class="task-manual-note">
                            –≠—Ç–æ —Ä—É—á–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Äî –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –≤ IDE –ø–æ –¢–ó –Ω–∏–∂–µ.
                        </div>
                        {{end}}
                        
                        <div class="task-prompt markdown">
                            {{.PromptMD | markdown}}
                        </div>
                        
                        {{if .Criteria}}
                        <div class="task-criteria">
                            <h4>‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:</h4>
                            <div class="markdown">{{.Criteria | markdown}}</div>
                        </div>
                        {{end}}
                        
                        {{if .Hints}}
                        <details class="task-hints">
                            <summary>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏</summary>
                            <div class="markdown">{{.Hints | markdown}}</div>
                        </details>
                        {{end}}
                        
                        {{if ne .Mode "manual"}}
                        <div class="code-editor">
                            <h4>üìù –ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥:</h4>
                            <textarea class="code-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∫–æ–¥ –∑–¥–µ—Å—å...">{{.StarterCode}}</textarea>
                        </div>
                        {{end}}
                        
                        {{if and (ne .Mode "manual") .ExpectedOutput}}
                        <details class="task-expected">
                            <summary>üéØ –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥</summary>
                            <pre class="expected-output">{{.ExpectedOutput}}</pre>
                        </details>
                        {{end}}
                        
                        <div class="task-actions">
                            {{if eq .Mode "manual"}}
                                {{if index $.CompletedTasks .ID}}
                                <button class="btn btn-primary complete-btn" disabled>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ</button>
                                {{else}}
                                <button class="btn btn-primary complete-btn">‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º</button>
                                {{end}}
                            {{else}}
                            <button class="btn btn-secondary run-btn">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                            <button class="btn btn-primary check-btn">‚úì –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                            {{end}}
                        </div>
                        
                        <div class="task-output" style="display: none;">
                            <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
                            <pre class="output-content"></pre>
                        </div>
                    </div>
                    {{end}}
                </section>
                {{end}}
                
                <section id="notes" class="lesson-section section-notes">
                    <h2>üìí –ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏</h2>
                    <div class="notes-editor">
                        <textarea class="notes-input" 
                                  data-lesson-id="{{.Lesson.ID}}"
                                  placeholder="–ó–∞–ø–∏—à–∏—Ç–µ –≤–∞–∂–Ω—ã–µ –º—ã—Å–ª–∏, –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –∑–∞–º–µ—Ç–∫–∏...">{{.Note.NoteMD}}</textarea>
                        <button class="btn btn-secondary save-notes-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <span class="notes-status"></span>
                    </div>
                </section>
            </article>
        </div>
    </main>
    
    {{template "footer" .}}
    {{template "scripts" .}}
</body>
</html>
